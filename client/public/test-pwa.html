<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Instala√ß√£o - R√°dioPlay</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        .container {
            background: white;
            border-radius: 24px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.2);
        }
        h1 {
            color: #7c3aed;
            font-size: 28px;
            margin-bottom: 10px;
            text-align: center;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .status-box {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }
        .status-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }
        .status-item:last-child {
            border-bottom: none;
        }
        .status-icon {
            width: 24px;
            height: 24px;
            margin-right: 12px;
        }
        .success { color: #28a745; }
        .error { color: #dc3545; }
        .warning { color: #ffc107; }
        .install-btn {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: transform 0.2s;
        }
        .install-btn:hover {
            transform: scale(1.05);
        }
        .install-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .instructions {
            margin-top: 30px;
            padding: 20px;
            background: #f0f7ff;
            border-radius: 12px;
            border: 1px solid #cce5ff;
        }
        .instructions h3 {
            color: #004085;
            margin-bottom: 15px;
        }
        .instructions ol {
            margin-left: 20px;
            color: #004085;
        }
        .instructions li {
            margin: 8px 0;
        }
        .device-icon {
            text-align: center;
            font-size: 48px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="device-icon">üì±</div>
        <h1>Instalar R√°dioPlay</h1>
        <p class="subtitle">Transforme o site em um app no seu dispositivo</p>

        <div class="status-box">
            <div class="status-item">
                <span class="status-icon" id="pwa-icon">‚è≥</span>
                <span id="pwa-status">Verificando PWA...</span>
            </div>
            <div class="status-item">
                <span class="status-icon" id="sw-icon">‚è≥</span>
                <span id="sw-status">Verificando Service Worker...</span>
            </div>
            <div class="status-item">
                <span class="status-icon" id="install-icon">‚è≥</span>
                <span id="install-status">Verificando instala√ß√£o...</span>
            </div>
        </div>

        <button class="install-btn" id="installBtn" onclick="installApp()">
            Instalar Agora
        </button>

        <div class="instructions" id="instructions" style="display: none;">
            <h3>üìå Como instalar manualmente:</h3>
            <div id="platform-instructions"></div>
        </div>
    </div>

    <script>
        let deferredPrompt = null;
        const installBtn = document.getElementById('installBtn');

        // Check PWA status
        async function checkPWA() {
            try {
                const response = await fetch('/manifest.json');
                const manifest = await response.json();
                
                if (manifest && manifest.name) {
                    document.getElementById('pwa-icon').innerHTML = '‚úÖ';
                    document.getElementById('pwa-icon').className = 'status-icon success';
                    document.getElementById('pwa-status').innerHTML = 'PWA configurado corretamente';
                }
            } catch (e) {
                document.getElementById('pwa-icon').innerHTML = '‚ùå';
                document.getElementById('pwa-icon').className = 'status-icon error';
                document.getElementById('pwa-status').innerHTML = 'Erro no manifest.json';
            }
        }

        // Check Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => {
                    document.getElementById('sw-icon').innerHTML = '‚úÖ';
                    document.getElementById('sw-icon').className = 'status-icon success';
                    document.getElementById('sw-status').innerHTML = 'Service Worker ativo';
                })
                .catch(err => {
                    document.getElementById('sw-icon').innerHTML = '‚ùå';
                    document.getElementById('sw-icon').className = 'status-icon error';
                    document.getElementById('sw-status').innerHTML = 'Erro no Service Worker';
                });
        } else {
            document.getElementById('sw-icon').innerHTML = '‚ö†Ô∏è';
            document.getElementById('sw-icon').className = 'status-icon warning';
            document.getElementById('sw-status').innerHTML = 'Service Worker n√£o suportado';
        }

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('install-icon').innerHTML = '‚úÖ';
            document.getElementById('install-icon').className = 'status-icon success';
            document.getElementById('install-status').innerHTML = 'App j√° est√° instalado!';
            installBtn.disabled = true;
            installBtn.textContent = 'J√° Instalado';
        }

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            
            document.getElementById('install-icon').innerHTML = '‚úÖ';
            document.getElementById('install-icon').className = 'status-icon success';
            document.getElementById('install-status').innerHTML = 'Pronto para instalar';
            
            installBtn.disabled = false;
        });

        // Detect platform
        function detectPlatform() {
            const userAgent = navigator.userAgent.toLowerCase();
            
            if (/iphone|ipad|ipod/.test(userAgent)) {
                return 'ios';
            } else if (/android/.test(userAgent)) {
                return 'android';
            } else {
                return 'desktop';
            }
        }

        // Install function
        async function installApp() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    console.log('Usu√°rio instalou o app');
                    installBtn.disabled = true;
                    installBtn.textContent = 'Instalado!';
                }
                
                deferredPrompt = null;
            } else {
                // Show platform-specific instructions
                const platform = detectPlatform();
                const instructionsDiv = document.getElementById('instructions');
                const platformInstructions = document.getElementById('platform-instructions');
                
                instructionsDiv.style.display = 'block';
                
                if (platform === 'ios') {
                    platformInstructions.innerHTML = `
                        <ol>
                            <li>Abra este site no <strong>Safari</strong></li>
                            <li>Toque no bot√£o <strong>Compartilhar</strong> üîó</li>
                            <li>Role e toque em <strong>"Adicionar √† Tela de In√≠cio"</strong></li>
                            <li>Toque em <strong>"Adicionar"</strong></li>
                        </ol>
                    `;
                } else if (platform === 'android') {
                    platformInstructions.innerHTML = `
                        <ol>
                            <li>Abra este site no <strong>Chrome</strong></li>
                            <li>Toque no menu ‚ãÆ</li>
                            <li>Selecione <strong>"Adicionar √† tela inicial"</strong></li>
                            <li>Confirme a instala√ß√£o</li>
                        </ol>
                    `;
                } else {
                    platformInstructions.innerHTML = `
                        <ol>
                            <li>No Chrome ou Edge, procure o √≠cone de instala√ß√£o na barra de endere√ßos</li>
                            <li>Ou acesse o menu do navegador</li>
                            <li>Selecione <strong>"Instalar R√°dioPlay"</strong></li>
                            <li>Confirme a instala√ß√£o</li>
                        </ol>
                    `;
                }
                
                document.getElementById('install-icon').innerHTML = '‚ö†Ô∏è';
                document.getElementById('install-icon').className = 'status-icon warning';
                document.getElementById('install-status').innerHTML = 'Use as instru√ß√µes abaixo';
            }
        }

        // Check PWA on load
        checkPWA();

        // Listen for app installed
        window.addEventListener('appinstalled', () => {
            console.log('PWA foi instalado');
            installBtn.disabled = true;
            installBtn.textContent = 'Instalado com Sucesso!';
        });
    </script>
</body>
</html>