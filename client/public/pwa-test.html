<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>R√°dioPlay PWA - Teste de Instala√ß√£o</title>
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#7c3aed">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #7c3aed;
            text-align: center;
            font-size: 28px;
            margin-bottom: 10px;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
        }
        .success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #6ee7b7;
        }
        .info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        .warning {
            background: #fed7aa;
            color: #92400e;
            border: 1px solid #fdba74;
        }
        button {
            background: #7c3aed;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            font-weight: bold;
            border-radius: 10px;
            cursor: pointer;
            width: 100%;
            margin: 10px 0;
        }
        button:hover {
            background: #6d28d9;
        }
        button:disabled {
            background: #e5e7eb;
            color: #9ca3af;
            cursor: not-allowed;
        }
        .instructions {
            background: #f3f4f6;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }
        .instructions h3 {
            margin-top: 0;
            color: #374151;
        }
        .instructions ol {
            margin: 10px 0;
            padding-left: 20px;
            color: #4b5563;
        }
        .instructions li {
            margin: 8px 0;
        }
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .icon-item {
            text-align: center;
            font-size: 11px;
            color: #6b7280;
        }
        .icon-item img {
            width: 100%;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ R√°dioPlay PWA</h1>
        <p style="text-align: center; color: #6b7280; margin-top: 0;">
            Teste de Instala√ß√£o Progressive Web App
        </p>

        <div id="status-container"></div>

        <button id="install-btn" style="display: none;">
            üì≤ Instalar App Agora
        </button>

        <div class="instructions">
            <h3>üì± Como Instalar no Android</h3>
            <ol>
                <li>Abra esta p√°gina no Chrome</li>
                <li>Toque no menu (‚ãÆ) no canto superior</li>
                <li>Selecione "Adicionar √† tela inicial"</li>
                <li>Confirme a instala√ß√£o</li>
            </ol>
        </div>

        <div class="instructions">
            <h3>üçé Como Instalar no iPhone/iPad</h3>
            <ol>
                <li><strong>USE O SAFARI!</strong> (N√£o funciona em outros navegadores)</li>
                <li>Toque no bot√£o compartilhar (üîó) na barra inferior</li>
                <li>Role e toque em "Adicionar √† Tela de In√≠cio"</li>
                <li>Toque em "Adicionar" no canto superior direito</li>
            </ol>
        </div>

        <div class="instructions">
            <h3>üíª Como Instalar no Desktop</h3>
            <ol>
                <li>Abra no Chrome, Edge ou Brave</li>
                <li>Clique no √≠cone de instala√ß√£o na barra de endere√ßos</li>
                <li>Ou acesse o menu ‚Üí "Instalar R√°dioPlay"</li>
            </ol>
        </div>

        <div class="status info">
            <strong>Recursos PWA Dispon√≠veis:</strong><br>
            ‚úÖ Instala√ß√£o como app nativo<br>
            ‚úÖ Funciona offline<br>
            ‚úÖ √çcone na tela inicial<br>
            ‚úÖ Abre em tela cheia<br>
            ‚úÖ Notifica√ß√µes push (em breve)
        </div>

        <div class="icon-grid">
            <div class="icon-item">
                <img src="/icon-48x48.png" alt="48x48">
                <div>48x48</div>
            </div>
            <div class="icon-item">
                <img src="/icon-96x96.png" alt="96x96">
                <div>96x96</div>
            </div>
            <div class="icon-item">
                <img src="/icon-144x144.png" alt="144x144">
                <div>144x144</div>
            </div>
            <div class="icon-item">
                <img src="/icon-192x192.png" alt="192x192">
                <div>192x192</div>
            </div>
        </div>
    </div>

    <script>
        let deferredPrompt;
        const statusContainer = document.getElementById('status-container');
        const installBtn = document.getElementById('install-btn');

        // Check PWA Status
        function checkPWAStatus() {
            const statuses = [];

            // Check if running as installed PWA
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches ||
                                  window.navigator.standalone ||
                                  document.referrer.includes('android-app://');
            
            if (isStandalone) {
                statuses.push({
                    type: 'success',
                    text: '‚úÖ App j√° est√° instalado e rodando!'
                });
            }

            // Check HTTPS
            if (location.protocol === 'https:' || location.hostname === 'localhost') {
                statuses.push({
                    type: 'success',
                    text: '‚úÖ HTTPS/Localhost detectado'
                });
            } else {
                statuses.push({
                    type: 'warning',
                    text: '‚ö†Ô∏è PWA requer HTTPS (exceto localhost)'
                });
            }

            // Check Service Worker
            if ('serviceWorker' in navigator) {
                statuses.push({
                    type: 'success',
                    text: '‚úÖ Service Worker suportado'
                });
                
                // Register Service Worker
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => {
                        console.log('Service Worker registrado:', reg);
                        addStatus('success', '‚úÖ Service Worker registrado com sucesso!');
                    })
                    .catch(err => {
                        console.error('Erro ao registrar SW:', err);
                        addStatus('warning', '‚ö†Ô∏è Erro ao registrar Service Worker');
                    });
            } else {
                statuses.push({
                    type: 'warning',
                    text: '‚ö†Ô∏è Service Worker n√£o suportado neste navegador'
                });
            }

            // Check browser
            const userAgent = navigator.userAgent.toLowerCase();
            if (userAgent.includes('safari') && !userAgent.includes('chrome')) {
                statuses.push({
                    type: 'info',
                    text: 'üì± Safari detectado - Use o bot√£o compartilhar para instalar'
                });
            } else if (userAgent.includes('chrome') || userAgent.includes('edge')) {
                statuses.push({
                    type: 'success',
                    text: '‚úÖ Navegador compat√≠vel com instala√ß√£o autom√°tica'
                });
            }

            // Display statuses
            statuses.forEach(status => addStatus(status.type, status.text));
        }

        function addStatus(type, text) {
            const div = document.createElement('div');
            div.className = `status ${type}`;
            div.innerHTML = text;
            statusContainer.appendChild(div);
        }

        // Handle install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installBtn.style.display = 'block';
            addStatus('success', '‚úÖ Instala√ß√£o dispon√≠vel! Use o bot√£o abaixo.');
        });

        installBtn.addEventListener('click', async () => {
            if (!deferredPrompt) return;
            
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            
            if (outcome === 'accepted') {
                addStatus('success', 'üéâ App instalado com sucesso!');
            } else {
                addStatus('info', 'Instala√ß√£o cancelada');
            }
            
            deferredPrompt = null;
            installBtn.style.display = 'none';
        });

        // Check on load
        checkPWAStatus();
    </script>
</body>
</html>