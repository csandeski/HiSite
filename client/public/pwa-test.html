<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste PWA - R√°dioPlay</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        h1 {
            color: #333;
            margin: 0 0 10px 0;
        }
        .status {
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 14px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px 5px;
            font-weight: 600;
        }
        button:hover {
            transform: scale(1.05);
        }
        .instructions {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        .platform {
            font-weight: bold;
            color: #667eea;
        }
        ul {
            margin: 10px 0;
        }
        li {
            margin: 8px 0;
        }
        .icon-test {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 20px 0;
        }
        .icon-test img {
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>üöÄ Teste PWA R√°dioPlay</h1>
        <p>Verifica√ß√£o completa do Progressive Web App</p>

        <div id="manifestStatus" class="status">Verificando manifest...</div>
        <div id="swStatus" class="status">Verificando Service Worker...</div>
        <div id="httpsStatus" class="status">Verificando HTTPS...</div>
        <div id="installStatus" class="status">Verificando instala√ß√£o...</div>

        <div class="icon-test">
            <img src="/icon-192x192.png" width="48" height="48" alt="√çcone 192">
            <img src="/icon-512x512.png" width="48" height="48" alt="√çcone 512">
        </div>

        <button onclick="installPWA()">üéØ Instalar App</button>
        <button onclick="testOffline()">üì° Testar Offline</button>
        <button onclick="window.location.href='/'">üè† Voltar ao App</button>

        <div class="instructions">
            <h3>üì± Como Instalar:</h3>
            
            <div class="platform">Android (Chrome):</div>
            <ul>
                <li>Clique no bot√£o "Instalar App" acima</li>
                <li>Ou menu ‚ãÆ ‚Üí "Adicionar √† tela inicial"</li>
            </ul>

            <div class="platform">iPhone/iPad (Safari):</div>
            <ul>
                <li>Toque em Compartilhar üîó</li>
                <li>Role e toque "Adicionar √† Tela de In√≠cio"</li>
                <li>Toque em "Adicionar"</li>
            </ul>

            <div class="platform">Desktop (Chrome/Edge):</div>
            <ul>
                <li>Clique no √≠cone de instalar na barra de endere√ßos</li>
                <li>Ou clique no bot√£o "Instalar App" acima</li>
            </ul>
        </div>

        <div id="log" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let deferredPrompt;
        const log = document.getElementById('log');

        function addLog(message) {
            const time = new Date().toLocaleTimeString();
            log.innerHTML += `[${time}] ${message}<br>`;
        }

        // Check manifest
        fetch('/manifest.json')
            .then(r => r.json())
            .then(manifest => {
                document.getElementById('manifestStatus').className = 'status success';
                document.getElementById('manifestStatus').innerHTML = '‚úÖ Manifest.json OK - ' + manifest.name;
                addLog('Manifest carregado: ' + manifest.short_name);
            })
            .catch(e => {
                document.getElementById('manifestStatus').className = 'status error';
                document.getElementById('manifestStatus').innerHTML = '‚ùå Erro no manifest: ' + e.message;
            });

        // Check HTTPS
        const isSecure = location.protocol === 'https:' || location.hostname === 'localhost';
        if (isSecure) {
            document.getElementById('httpsStatus').className = 'status success';
            document.getElementById('httpsStatus').innerHTML = '‚úÖ Conex√£o segura (HTTPS ou localhost)';
        } else {
            document.getElementById('httpsStatus').className = 'status warning';
            document.getElementById('httpsStatus').innerHTML = '‚ö†Ô∏è PWA requer HTTPS para instala√ß√£o';
        }

        // Check Service Worker
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js')
                .then(reg => {
                    document.getElementById('swStatus').className = 'status success';
                    document.getElementById('swStatus').innerHTML = '‚úÖ Service Worker registrado';
                    addLog('SW registrado com sucesso');
                    
                    // Check for updates
                    reg.update();
                })
                .catch(e => {
                    document.getElementById('swStatus').className = 'status error';
                    document.getElementById('swStatus').innerHTML = '‚ùå Erro no Service Worker: ' + e.message;
                    addLog('Erro SW: ' + e.message);
                });
        } else {
            document.getElementById('swStatus').className = 'status error';
            document.getElementById('swStatus').innerHTML = '‚ùå Service Worker n√£o suportado';
        }

        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            document.getElementById('installStatus').className = 'status success';
            document.getElementById('installStatus').innerHTML = '‚úÖ App j√° instalado e rodando!';
            addLog('App em modo standalone');
        } else {
            document.getElementById('installStatus').className = 'status warning';
            document.getElementById('installStatus').innerHTML = 'üì≤ App pronto para instalar';
        }

        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installStatus').className = 'status success';
            document.getElementById('installStatus').innerHTML = '‚úÖ Instala√ß√£o dispon√≠vel - clique no bot√£o!';
            addLog('Prompt de instala√ß√£o dispon√≠vel');
        });

        // Install function
        async function installPWA() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                
                if (outcome === 'accepted') {
                    addLog('‚úÖ Usu√°rio aceitou instalar!');
                    document.getElementById('installStatus').className = 'status success';
                    document.getElementById('installStatus').innerHTML = '‚úÖ App instalado com sucesso!';
                } else {
                    addLog('‚ùå Usu√°rio cancelou instala√ß√£o');
                }
                deferredPrompt = null;
            } else {
                // Show platform-specific instructions
                const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
                if (isIOS) {
                    alert('No iPhone/iPad:\n\n1. Use o Safari\n2. Toque em Compartilhar üîó\n3. "Adicionar √† Tela de In√≠cio"');
                } else {
                    alert('Para instalar:\n\n‚Ä¢ Chrome: Menu ‚ãÆ ‚Üí "Adicionar √† tela inicial"\n‚Ä¢ Edge: Menu ‚Üí "Aplicativos" ‚Üí "Instalar"');
                }
            }
        }

        // Test offline
        function testOffline() {
            if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
                addLog('Testando modo offline...');
                fetch('/offline.html')
                    .then(r => r.text())
                    .then(() => {
                        addLog('‚úÖ P√°gina offline em cache');
                        alert('Modo offline funcionando! Desconecte a internet e recarregue a p√°gina para testar.');
                    })
                    .catch(e => addLog('‚ùå Erro: ' + e.message));
            } else {
                alert('Service Worker ainda n√£o est√° ativo. Recarregue a p√°gina e tente novamente.');
            }
        }

        // App installed event
        window.addEventListener('appinstalled', () => {
            addLog('üéâ App instalado com sucesso!');
            document.getElementById('installStatus').className = 'status success';
            document.getElementById('installStatus').innerHTML = 'üéâ App instalado! Procure o √≠cone na sua tela inicial.';
        });
    </script>
</body>
</html>